# Compass Roulette

## このドキュメントについて

- コンパスルーレットを実装するにあたっての方針を示すガイドです．
- 新しい機能を実装する際はここで示す技術選定・設計方針・モジュール構成を前提にしてください．
- 不確かな点がある場合は，リポジトリのファイルを探索し，ユーザーに「こういうことですか?」と確認をするようにしてください．

## 前提条件

- 基本的に`copilot-instructions.md`を参照すること．

## サービス概要

- **#コンパス 戦闘摂理解析システム(以下コンパス)** のランダムデッキメーカーです．
- ユーザー側で細かく条件を指定することができます．

## サービス仕様

- データは JSON ファイルの **キーと値の構造をそのまま利用**して扱うこと．
- ルーレットの抽選対象は，JSON のキー（カード名，ヒーロー名，ステージ名）を最小単位とし，ユーザーが指定した条件は **JSON 内のプロパティをフィルタキー**として直接適用すること．
- ルーレット画面には以下を表示すること
  - ルーレットで選ぶヒーローのロールの範囲
  - ルーレットで選ぶカードのレアリティの範囲
  - ステージをランダムで選出するか
  - 対戦する際のチーム人数
- 結果の画面には以下を表示すること
  - ヒーローの名前
  - 種類の違うカード4枚の情報
  - (必要に応じて)ステージ
- ユーザーが何度でもルーレットを引き直せるようにすること．
- JSON の構造変更は極力行わず，データ追加は既存フォーマットに従って行うこと．
- 条件指定エリアの各選択状態は，ルーレット実行後も保持されること．
- JSON のキーは識別子として扱い，内部的には string として保持すること．
- 別途 ID フィールドは追加しないこと．

## データについて

- データは JSON ファイルで保存して適宜アップデートしやすい形に保つこと．
- `public/compass/`へ配置すること．

## JSON ファイルについて

- JSON ファイルは，以下3ファイルとする．
  - `card.json`: コンパスの実装されているカードの情報を保持する．
  - `hero.json`: コンパスの実装されているヒーローの情報を保持する．
  - `stage.json`: コンパスの実装されているステージの情報を保持する．

### `card.json`のフォーマット

以下を1単位として追加していく．
例は以下．
```json
{
  // カード名: 全角半角両方
  "機構師弾 フルーク・ツォイク": {
    // カード属性: 火，水，風，無の4種類
    "attribute": "火",
    // カードのレアリティ: N，R，SR，URの4種類
    "rarity": "N",
    // カードのスキル: 近距離，遠距離，連続，周囲，回復，ガード，強化，弱体化，移動，設置，カウンター，その他の12種類
    "skill": "近距離",
    // カードの種類: 通常，コラボ，シーズン，イベントの4種類
    "type": "通常",
    // カードのランク: 空文字，F，E，D，C，B，A，S1の8種類
    "rank": "D",
  }
}
```

### `hero.json`のフォーマット

以下を1単位として追加していく．
例は以下．
```json
{
  // ヒーローの名前: 全角半角両方
  "コクリコット ブランシュ": {
    // ヒーローのロール: アタッカー，ガンナー，タンク，スプリンターの4種類
    "role": "スプリンター",
    // ヒーローの適正カード: 速，並，遅の3種類
    "card": {
      "近": "速",
      "遠": "遅",
      "周": "速",
      "連": "遅"
    },
    // コラボヒーローかどうか: true，falseの2種類
    "isCollab": false
  }
}
```

### `stage.json`のフォーマット

以下を1単位として追加していく．
例は以下．
```json
{
  // ステージ名: 全30種類
  "でらクランクストリート": {
    // チーム人数: 2か3の2種類
    "member": 3
  }
}
```

## ディレクトリ構造
```bash
src/
  app/
    page.tsx                # ホーム
    compass/
      page.tsx              # Compass Roulette トップ（条件指定）
      result/
        page.tsx            # ルーレット結果画面
      components/
        RouletteForm.tsx    # 条件指定 UI
        RouletteResult.tsx  # 結果表示 UI
        RouletteButton.tsx  # ルーレット実行ボタン
      hooks/
        useCompassData.ts   # JSON 読み込み
        useRoulette.ts      # 抽選ロジック
      lib/
        filter.ts           # フィルタ処理
        roulette.ts         # 抽選処理
      types/
        card.ts             # カード型定義
        hero.ts             # ヒーロー型定義
        stage.ts            # ステージ型定義
        index.ts            # 共通型定義
  public/
    compass/                # データ保存場所
      card.json             # カードデータ
      hero.json             # ヒーローデータ
      stage.json            # ステージデータ
  .github/
    copilot-instructions.md
    compass-roulette/
      instructions.md
```

## 画面一覧

### ルーレット画面
- 条件指定エリア
  - ヒーローロール選択（チェックボックス）
  - カードレアリティ選択（チェックボックス）
  - ステージ有無トグル
  - チーム人数選択
- 「ルーレットを回す」ボタン

### 結果画面
- 選出されたヒーロー名
- カード 4 枚表示
- ステージ（有効時のみ）
- 「もう一度回す」ボタン
